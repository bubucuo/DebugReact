{"ast":null,"code":"/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\nimport invariant from 'shared/invariant';\nimport { getInstanceFromNode, getFiberCurrentPropsFromNode } from './EventPluginUtils'; // Use to restore controlled state after a change event has fired.\n\nlet restoreImpl = null;\nlet restoreTarget = null;\nlet restoreQueue = null;\n\nfunction restoreStateOfTarget(target) {\n  // We perform this translation at the end of the event loop so that we\n  // always receive the correct fiber here\n  const internalInstance = getInstanceFromNode(target);\n\n  if (!internalInstance) {\n    // Unmounted\n    return;\n  }\n\n  invariant(typeof restoreImpl === 'function', 'setRestoreImplementation() needs to be called to handle a target for controlled ' + 'events. This error is likely caused by a bug in React. Please file an issue.');\n  const props = getFiberCurrentPropsFromNode(internalInstance.stateNode);\n  restoreImpl(internalInstance.stateNode, internalInstance.type, props);\n}\n\nexport function setRestoreImplementation(impl) {\n  restoreImpl = impl;\n}\nexport function enqueueStateRestore(target) {\n  if (restoreTarget) {\n    if (restoreQueue) {\n      restoreQueue.push(target);\n    } else {\n      restoreQueue = [target];\n    }\n  } else {\n    restoreTarget = target;\n  }\n}\nexport function needsStateRestore() {\n  return restoreTarget !== null || restoreQueue !== null;\n}\nexport function restoreStateIfNeeded() {\n  if (!restoreTarget) {\n    return;\n  }\n\n  const target = restoreTarget;\n  const queuedTargets = restoreQueue;\n  restoreTarget = null;\n  restoreQueue = null;\n  restoreStateOfTarget(target);\n\n  if (queuedTargets) {\n    for (let i = 0; i < queuedTargets.length; i++) {\n      restoreStateOfTarget(queuedTargets[i]);\n    }\n  }\n}","map":{"version":3,"sources":["/Users/gaoshaoyun/Documents/library/debug-react/src/react/packages/legacy-events/ReactControlledComponent.js"],"names":["invariant","getInstanceFromNode","getFiberCurrentPropsFromNode","restoreImpl","restoreTarget","restoreQueue","restoreStateOfTarget","target","internalInstance","props","stateNode","type","setRestoreImplementation","impl","enqueueStateRestore","push","needsStateRestore","restoreStateIfNeeded","queuedTargets","i","length"],"mappings":"AAAA;;;;;;;;AASA,OAAOA,SAAP,MAAsB,kBAAtB;AAEA,SACEC,mBADF,EAEEC,4BAFF,QAGO,oBAHP,C,CAKA;;AAEA,IAAIC,WAAW,GAAG,IAAlB;AACA,IAAIC,aAAa,GAAG,IAApB;AACA,IAAIC,YAAY,GAAG,IAAnB;;AAEA,SAASC,oBAAT,CAA8BC,MAA9B,EAAsC;AACpC;AACA;AACA,QAAMC,gBAAgB,GAAGP,mBAAmB,CAACM,MAAD,CAA5C;;AACA,MAAI,CAACC,gBAAL,EAAuB;AACrB;AACA;AACD;;AACDR,EAAAA,SAAS,CACP,OAAOG,WAAP,KAAuB,UADhB,EAEP,qFACE,8EAHK,CAAT;AAKA,QAAMM,KAAK,GAAGP,4BAA4B,CAACM,gBAAgB,CAACE,SAAlB,CAA1C;AACAP,EAAAA,WAAW,CAACK,gBAAgB,CAACE,SAAlB,EAA6BF,gBAAgB,CAACG,IAA9C,EAAoDF,KAApD,CAAX;AACD;;AAED,OAAO,SAASG,wBAAT,CACLC,IADK,EAEC;AACNV,EAAAA,WAAW,GAAGU,IAAd;AACD;AAED,OAAO,SAASC,mBAAT,CAA6BP,MAA7B,EAAwD;AAC7D,MAAIH,aAAJ,EAAmB;AACjB,QAAIC,YAAJ,EAAkB;AAChBA,MAAAA,YAAY,CAACU,IAAb,CAAkBR,MAAlB;AACD,KAFD,MAEO;AACLF,MAAAA,YAAY,GAAG,CAACE,MAAD,CAAf;AACD;AACF,GAND,MAMO;AACLH,IAAAA,aAAa,GAAGG,MAAhB;AACD;AACF;AAED,OAAO,SAASS,iBAAT,GAAsC;AAC3C,SAAOZ,aAAa,KAAK,IAAlB,IAA0BC,YAAY,KAAK,IAAlD;AACD;AAED,OAAO,SAASY,oBAAT,GAAgC;AACrC,MAAI,CAACb,aAAL,EAAoB;AAClB;AACD;;AACD,QAAMG,MAAM,GAAGH,aAAf;AACA,QAAMc,aAAa,GAAGb,YAAtB;AACAD,EAAAA,aAAa,GAAG,IAAhB;AACAC,EAAAA,YAAY,GAAG,IAAf;AAEAC,EAAAA,oBAAoB,CAACC,MAAD,CAApB;;AACA,MAAIW,aAAJ,EAAmB;AACjB,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,aAAa,CAACE,MAAlC,EAA0CD,CAAC,EAA3C,EAA+C;AAC7Cb,MAAAA,oBAAoB,CAACY,aAAa,CAACC,CAAD,CAAd,CAApB;AACD;AACF;AACF","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\nimport invariant from 'shared/invariant';\n\nimport {\n  getInstanceFromNode,\n  getFiberCurrentPropsFromNode,\n} from './EventPluginUtils';\n\n// Use to restore controlled state after a change event has fired.\n\nlet restoreImpl = null;\nlet restoreTarget = null;\nlet restoreQueue = null;\n\nfunction restoreStateOfTarget(target) {\n  // We perform this translation at the end of the event loop so that we\n  // always receive the correct fiber here\n  const internalInstance = getInstanceFromNode(target);\n  if (!internalInstance) {\n    // Unmounted\n    return;\n  }\n  invariant(\n    typeof restoreImpl === 'function',\n    'setRestoreImplementation() needs to be called to handle a target for controlled ' +\n      'events. This error is likely caused by a bug in React. Please file an issue.',\n  );\n  const props = getFiberCurrentPropsFromNode(internalInstance.stateNode);\n  restoreImpl(internalInstance.stateNode, internalInstance.type, props);\n}\n\nexport function setRestoreImplementation(\n  impl: (domElement: Element, tag: string, props: Object) => void,\n): void {\n  restoreImpl = impl;\n}\n\nexport function enqueueStateRestore(target: EventTarget): void {\n  if (restoreTarget) {\n    if (restoreQueue) {\n      restoreQueue.push(target);\n    } else {\n      restoreQueue = [target];\n    }\n  } else {\n    restoreTarget = target;\n  }\n}\n\nexport function needsStateRestore(): boolean {\n  return restoreTarget !== null || restoreQueue !== null;\n}\n\nexport function restoreStateIfNeeded() {\n  if (!restoreTarget) {\n    return;\n  }\n  const target = restoreTarget;\n  const queuedTargets = restoreQueue;\n  restoreTarget = null;\n  restoreQueue = null;\n\n  restoreStateOfTarget(target);\n  if (queuedTargets) {\n    for (let i = 0; i < queuedTargets.length; i++) {\n      restoreStateOfTarget(queuedTargets[i]);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}